import{W as A}from"./UtilityNavbar-CLKz3Cml.js";import B from"./TemplateDefault-CqYOzbhH.js";import{S as R}from"./SectionHero-CduRNjeK.js";import{T as S,u as T,a as q}from"./unzipit.module-DMZmEVgb.js";import{_ as z,c as O,w as b,r as g,o as l,a as j,b as o,t as p,d as h,e as c,v as m,g as a,k as u,h as f,F as y,f as w,j as E}from"./index-BW0mYOuV.js";const I={components:{WrapperPage:A,TemplateDefault:B,SectionHero:R},props:["renderer"],inject:["io"],data:()=>({dockerComposeFile:"",files:[],name:"",slug:"",repository:"",branch:"",branches:[],adjustVolumes:!0,inherit:!0,running:!1,webhook:!1,searchRepos:!1,oauthProviders:[],consentUrl:"",search:"",user:null,query:"",organisations:[],repositories:null}),watch:{async searchRepos(e){e&&(await this.getOAuthProviders(),await this.getUser(),await this.getOrganisations(),!this.query&&this.orgs.length&&(this.query=this.orgs[0].query,await this.getRepositories()))},async query(){await this.getRepositories()},async repository(e){var r;const t=(r=this.repositories)==null?void 0:r.items.find(n=>n.clone_url===e);t&&(this.branch=t.default_branch,await this.getBranches(t))}},computed:{id(){return this.$route.params.id||this.slug},oauthProvidersFiltered(){const e=["github"];return this.oauthProviders.filter(t=>e.includes(t.provider))},orgs(){var e,t;return[{title:(e=this.user)==null?void 0:e.login,query:`user:${(t=this.user)==null?void 0:t.login}`},...this.organisations.map(r=>{var n,d;return{title:(n=r==null?void 0:r.organization)==null?void 0:n.login,query:`org:${(d=r==null?void 0:r.organization)==null?void 0:d.login}`}})]}},async created(){await this.getOAuthProviders(),this.id&&await this.getItem()},methods:{async getUser(){const e=this.oauthProvidersFiltered.find(t=>t.provider==="github");if(e){let t=await fetch("https://api.github.com/user",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.user=await t.json(),console.log("user",this.user)}},async getOrganisations(){const e=this.oauthProvidersFiltered.find(t=>t.provider==="github");if(e){let t=await fetch("https://api.github.com/user/memberships/orgs?per_page=150",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.organisations=await t.json(),console.log("orgs",this.organisations)}},async getRepositories(){const e=this.oauthProvidersFiltered.find(t=>t.provider==="github");if(e){let t="q="+encodeURIComponent(this.search+(" "+this.query||" user:"+this.user.login)),r=await fetch(`https://api.github.com/search/repositories?${t}&per_page=150`,{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.repositories=await r.json(),console.log("repos",this.repositories)}},async getBranches(e){const t=this.oauthProvidersFiltered.find(r=>r.provider==="github");if(t){let r=await fetch(e.branches_url.replace("{/branch}","")+"?per_page=150",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${t.token}`}});this.branches=await r.json(),console.log("branches",this.branches)}},consent(e){e&&window.open(e,"_blank")},async getOAuthProviders(){const e=await this.io.service("oauth_providers").find({query:{}});this.oauthProviders=e==null?void 0:e.data},async getItem(){const e=await this.io.service("apps").get(this.id);this.name=e.name,this.slug=e.id,this.repository=e.repository,this.branch=e.branch,this.adjustVolumes=e.adjustVolumes,this.inherit=e.inherit,this.running=e.running,this.dockerComposeFile=e.dockerComposeFile,this.webhook=e.webhook,console.log(e)},async remove(){const e=await this.io.service("apps").remove(this.id);console.log("res",e)},async attach(){const e=await this.io.service("apps").patch(this.id,{attach:!0});console.log("res",e)},async detach(){const e=await this.io.service("apps").patch(this.id,{detach:!0});console.log("res",e)},async status(){const e=await this.io.service("apps").patch(this.id,{status:!0});console.log("res",e)},async start(){const e=await this.io.service("apps").patch(this.id,{start:!0});console.log("res",e)},async stop(){const e=await this.io.service("apps").patch(this.id,{stop:!0});console.log("res",e)},async build(){const e=await this.io.service("apps").patch(this.id,{build:!0});console.log("res",e)},async destroy(){const e=await this.io.service("apps").patch(this.id,{destroy:!0});console.log("res",e)},async compose(){const e=await this.io.service("apps").patch(this.id,{compose:this.dockerComposeFile});console.log("res",e)},async deploy(){var e;try{console.log("files",this.files);const t=await this.io.service("apps").create({name:this.name,slug:this.id,buffer:(e=this.files)!=null&&e.length?await this.packTar():null,repository:this.repository,branch:this.branch,dockerComposeFile:this.dockerComposeFile,adjustVolumes:this.adjustVolumes,inherit:this.inherit});console.log("res",t)}catch(t){console.log("error",t)}},async update(){var e;try{const t=await this.io.service("apps").update(this.id,{buffer:(e=this.files)!=null&&e.length?await this.packTar():null,repository:this.repository,dockerComposeFile:this.dockerComposeFile,inherit:this.inherit,adjustVolumes:this.adjustVolumes,branch:this.branch,name:this.name});console.log("res",t)}catch(t){console.log("error",t)}},async packTar(){let e=new S;for await(let t of this.files)e.append(t.name,new Uint8Array(t.buffer));return e.out},async resolveDockerCompose(){const e=this.files.find(t=>t.name.endsWith("docker-compose.yml"));if(e){const t=new TextDecoder().decode(e.buffer);this.dockerComposeFile=t}},async uploadZip(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!1,t.accept=".zip",t.onchange=async()=>{let r=Array.from(t.files)[0];const{entries:n}=await T(await r.arrayBuffer());for await(const[d,i]of Object.entries(n))n[d].isDirectory||this.files.push({buffer:await i.arrayBuffer(),name:d});await this.resolveDockerCompose(),e()},t.click()})},async uploadTar(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!1,t.accept=".tar",t.onchange=async()=>{let r=Array.from(t.files)[0],n=await q(await r.arrayBuffer());for await(let d of n)this.files.push({buffer:d.buffer,name:d.name});await this.resolveDockerCompose(),e()},t.click()})},async uploadFolder(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!0,t.webkitdirectory=!0,t.dir=!0,t.onchange=async()=>{let r=Array.from(t.files);for await(let n of r)this.files.push({buffer:await n.arrayBuffer(),name:n.webkitRelativePath});await this.resolveDockerCompose(),e()},t.click()})},async uploadFiles(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!0,t.onchange=async()=>{let r=Array.from(t.files);for await(let n of r){let d=await n.arrayBuffer();this.files.push({buffer:d,name:"root/"+n.name})}await this.resolveDockerCompose(),e()},t.click()})}}},N={class:"font-thin text-xl lg:text-3xl xl:pl-6 w-full text-center uppercase"},W={class:"mt-8 mb-20 relative overflow-auto w-full"},H={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},M=o("label",{class:"block my-2"}," Basic app settings ",-1),Z={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},K=o("label",{class:"block my-2"}," Upload using drop of Tar / Zip / Folder / Docker Compose File / Docker File ",-1),L={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},G={class:"block my-2"},J={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},Q=o("label",{class:"block my-2"}," Clone using a git provider ",-1),X={class:"mr-4 inline-block"},Y=["onClick"],x={key:0},_={class:"block my-2"},ee=["value"],te={class:"block my-2"},se=["value"],oe={class:"block my-2"},re=["value"],ie=o("label",{class:"block my-2"}," Repository ",-1),le=o("label",{class:"block my-2"}," Branch ",-1),ae=o("div",{class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},[o("label",{class:"block my-2"}," One click installation browsing images from docker hub ")],-1),ne={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},ue=o("label",{class:"block my-2"},"Docker Compose",-1),pe={class:"text-right"};function de(e,t,r,n,d,i){const U=g("SectionHero"),$=g("WrapperPage"),D=g("TemplateDefault");return l(),O(D,{renderer:r.renderer},{default:b(()=>[j(U,null,{default:b(()=>[o("h1",N,p(i.id||"Deploy Docker App"),1)]),_:1}),j($,{class:"p-6"},{default:b(()=>{var k,v,C,F,V;return[o("div",W,[o("div",H,[M,h(),c(o("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>e.name=s),placeholder:"Name",class:"px-4 py-2 block w-full mb-4"},null,512),[[m,e.name]]),e.$route.params.id?u("",!0):c((l(),a("input",{key:0,"onUpdate:modelValue":t[1]||(t[1]=s=>e.slug=s),placeholder:"Slug",class:"px-4 py-2 block w-full"},null,512)),[[m,e.slug]]),h(),e.$route.params.id?c((l(),a("input",{key:1,"onUpdate:modelValue":t[2]||(t[2]=s=>i.id=s),placeholder:"Slug",readonly:"",class:"px-4 py-2 block w-full"},null,512)),[[m,i.id]]):u("",!0)]),o("div",Z,[K,o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[3]||(t[3]=s=>i.uploadFiles())}," Upload files "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[4]||(t[4]=s=>e.uploadFolde())}," Upload folder "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[5]||(t[5]=s=>i.uploadTar())}," Upload tar "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[6]||(t[6]=s=>i.uploadZip())}," Upload zip ")]),o("div",L,[o("label",G," Files count: "+p(e.files.length),1)]),o("div",J,[Q,(l(!0),a(y,null,f(i.oauthProvidersFiltered,s=>(l(),a("div",X,[o("button",{class:"rounded p-2 bg-slate-200 mr-1",onClick:P=>i.consent(s.consent_url)}," Connect to "+p(s.provider),9,Y),o("button",{class:"rounded p-2 bg-slate-200",onClick:t[7]||(t[7]=P=>e.searchRepos=!e.searchRepos)},p(e.searchRepos?"Close":"Select repository"),1)]))),256)),e.searchRepos?(l(),a("div",x,[o("label",_," Select user / organisation ("+p(((k=i.orgs)==null?void 0:k.length)||"0")+") ",1),c(o("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>e.query=s),class:"mt-2 px-4 py-2 w-full"},[(l(!0),a(y,null,f(i.orgs,s=>(l(),a("option",{value:s.query},p(s.title),9,ee))),256))],512),[[w,e.query]]),c(o("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>e.search=s),placeholder:"Search for repository ...",class:"mt-2 px-4 py-2 w-full",onKeypress:t[10]||(t[10]=E(s=>i.getRepositories(),["enter"]))},null,544),[[m,e.search]]),o("button",{class:"rounded p-2 mt-2 w-full bg-slate-200",onClick:t[11]||(t[11]=s=>i.getRepositories())}," Search "),o("label",te," Select Repository ("+p(((C=(v=e.repositories)==null?void 0:v.items)==null?void 0:C.length)||"0")+") ",1),c(o("select",{"onUpdate:modelValue":t[12]||(t[12]=s=>e.repository=s),class:"mt-2 px-4 py-2 w-full"},[(l(!0),a(y,null,f((F=e.repositories)==null?void 0:F.items,s=>(l(),a("option",{value:s.clone_url},p(s.full_name),9,se))),256))],512),[[w,e.repository]]),o("label",oe," Select Branch ("+p(((V=e.branches)==null?void 0:V.length)||"0")+") ",1),c(o("select",{"onUpdate:modelValue":t[13]||(t[13]=s=>e.branch=s),class:"mt-2 px-4 py-2 w-full"},[(l(!0),a(y,null,f(e.branches,s=>(l(),a("option",{value:s.name},p(s.name),9,re))),256))],512),[[w,e.branch]])])):u("",!0),ie,c(o("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>e.repository=s),placeholder:"Repository url",class:"mt-2 px-4 py-2 w-full"},null,512),[[m,e.repository]]),le,c(o("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>e.branch=s),placeholder:"Branch",class:"mt-2 px-4 py-2 w-full"},null,512),[[m,e.branch]]),o("button",{class:"rounded p-2 bg-slate-200 mt-2",onClick:t[16]||(t[16]=s=>e.adjustVolumes=!e.adjustVolumes)}," Move volumes to app folder: "+p(e.adjustVolumes?"on":"Adjust volumes off"),1)]),ae,o("div",ne,[ue,o("button",{class:"rounded p-2 bg-slate-200 my-4",onClick:t[17]||(t[17]=s=>e.inherit=!e.inherit)},p(e.inherit?"Inherit original on":"Inherit original off"),1),h(),c(o("textarea",{class:"w-full p-4","onUpdate:modelValue":t[18]||(t[18]=s=>e.dockerComposeFile=s),rows:"10",placeholder:"docker-compose.override.yml"},null,512),[[m,e.dockerComposeFile]])]),o("div",pe,[e.$route.params.id?u("",!0):(l(),a("button",{key:0,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[19]||(t[19]=s=>i.deploy())}," Launch ")),e.$route.params.id?(l(),a("button",{key:1,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[20]||(t[20]=s=>i.update())}," Update ")):u("",!0),!e.webhook&&e.$route.params.id&&e.repository?(l(),a("button",{key:2,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[21]||(t[21]=s=>i.attach())}," Attach webhook ")):u("",!0),e.webhook&&e.$route.params.id&&e.repository?(l(),a("button",{key:3,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[22]||(t[22]=s=>i.detach())}," Detach webhook ")):u("",!0),!e.running&&e.$route.params.id?(l(),a("button",{key:4,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[23]||(t[23]=s=>i.start())}," Start ")):u("",!0),h(),e.running&&e.$route.params.id?(l(),a("button",{key:5,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[24]||(t[24]=s=>i.stop())}," Stop ")):u("",!0),h(),e.$route.params.id?(l(),a("button",{key:6,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[25]||(t[25]=s=>i.build())}," Build ")):u("",!0),h(),e.$route.params.id?(l(),a("button",{key:7,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[26]||(t[26]=s=>i.destroy())}," Destroy ")):u("",!0),h(),e.$route.params.id?(l(),a("button",{key:8,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[27]||(t[27]=s=>i.compose())}," Compose ")):u("",!0),h(),e.$route.params.id?(l(),a("button",{key:9,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[28]||(t[28]=s=>i.remove())}," Remove ")):u("",!0)])])]}),_:1})]),_:1},8,["renderer"])}const be=z(I,[["render",de]]);export{be as default};
