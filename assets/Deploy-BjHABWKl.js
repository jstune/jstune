import{W as B}from"./UtilityNavbar-DLZ47jcz.js";import S from"./TemplateDefault-DI5dSodj.js";import{S as R}from"./SectionHero-DI8v3K_3.js";import{T,u as q,a as z}from"./unzipit.module-DiqNZxeG.js";import{_ as I,c as N,w as g,r as w,o as a,a as D,b as o,t as d,d as n,e as h,v as m,g as u,k as p,h as y,F as b,f as k,j as O,p as E,l as W}from"./index-DBuycBla.js";const H={components:{WrapperPage:B,TemplateDefault:S,SectionHero:R},props:["renderer"],inject:["io"],data:()=>({dockerComposeFile:"",files:[],name:"",slug:"",repository:"",branch:"",branches:[],adjustVolumes:!0,inherit:!0,running:!1,webhook:!1,searchRepos:!1,oauthProviders:[],consentUrl:"",search:"",user:null,query:"",organisations:[],repositories:null}),watch:{async searchRepos(e){e&&(await this.getOAuthProviders(),await this.getUser(),await this.getOrganisations(),!this.query&&this.orgs.length&&(this.query=this.orgs[0].query,await this.getRepositories()))},async query(){await this.getRepositories()},async repository(e){var r;const t=(r=this.repositories)==null?void 0:r.items.find(l=>l.clone_url===e);t&&(this.branch=t.default_branch,await this.getBranches(t),await this.getDockerCompose(t))},async branch(e){var r;const t=(r=this.repositories)==null?void 0:r.items.find(l=>l.clone_url===this.repository);t&&await this.getDockerCompose(t)}},computed:{id(){return this.$route.params.id||this.slug},oauthProvidersFiltered(){const e=["github"];return this.oauthProviders.filter(t=>e.includes(t.provider))},orgs(){var e,t;return[{title:(e=this.user)==null?void 0:e.login,query:`user:${(t=this.user)==null?void 0:t.login}`},...this.organisations.map(r=>{var l,c;return{title:(l=r==null?void 0:r.organization)==null?void 0:l.login,query:`org:${(c=r==null?void 0:r.organization)==null?void 0:c.login}`}})]}},async created(){await this.getOAuthProviders(),this.id&&await this.getItem()},methods:{async getDockerCompose(e){const t=this.oauthProvidersFiltered.find(r=>r.provider==="github");if(t)try{const l=await(await fetch(e.contents_url.replace("{+path}","docker-compose.yml")+`?ref=${this.branch}`,{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${t.token}`}})).json();l.download_url&&(this.dockerComposeFile=await(await fetch(l.download_url)).text())}catch{console.error("Could not fetch docker-compose.yml",error)}},async getUser(){const e=this.oauthProvidersFiltered.find(t=>t.provider==="github");if(e){let t=await fetch("https://api.github.com/user",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.user=await t.json(),console.log("user",this.user)}},async getOrganisations(){const e=this.oauthProvidersFiltered.find(t=>t.provider==="github");if(e){let t=await fetch("https://api.github.com/user/memberships/orgs?per_page=150",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.organisations=await t.json(),console.log("orgs",this.organisations)}},async getRepositories(){const e=this.oauthProvidersFiltered.find(t=>t.provider==="github");if(e){let t="q="+encodeURIComponent(this.search+(" "+this.query||" user:"+this.user.login)),r=await fetch(`https://api.github.com/search/repositories?${t}&per_page=150`,{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.repositories=await r.json(),console.log("repos",this.repositories)}},async getBranches(e){const t=this.oauthProvidersFiltered.find(r=>r.provider==="github");if(t){let r=await fetch(e.branches_url.replace("{/branch}","")+"?per_page=150",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${t.token}`}});this.branches=await r.json(),console.log("branches",this.branches)}},consent(e){e&&window.open(e,"_blank")},async getOAuthProviders(){const e=await this.io.service("oauth_providers").find({query:{}});this.oauthProviders=e==null?void 0:e.data},async getItem(){const e=await this.io.service("apps").get(this.id);this.name=e.name,this.slug=e.id,this.repository=e.repository,this.branch=e.branch,this.adjustVolumes=e.adjustVolumes,this.inherit=e.inherit,this.running=e.running,this.dockerComposeFile=e.dockerComposeFile,this.webhook=e.webhook,console.log(e)},async remove(){const e=await this.io.service("apps").remove(this.id);console.log("res",e)},async attach(){const e=await this.io.service("apps").patch(this.id,{attach:!0});console.log("res",e)},async detach(){const e=await this.io.service("apps").patch(this.id,{detach:!0});console.log("res",e)},async status(){const e=await this.io.service("apps").patch(this.id,{status:!0});console.log("res",e)},async start(){const e=await this.io.service("apps").patch(this.id,{start:!0});console.log("res",e)},async stop(){const e=await this.io.service("apps").patch(this.id,{stop:!0});console.log("res",e)},async build(){const e=await this.io.service("apps").patch(this.id,{build:!0});console.log("res",e)},async destroy(){const e=await this.io.service("apps").patch(this.id,{destroy:!0});console.log("res",e)},async compose(){const e=await this.io.service("apps").patch(this.id,{compose:this.dockerComposeFile});console.log("res",e)},async deploy(){var e;try{console.log("files",this.files);const t=await this.io.service("apps").create({name:this.name,slug:this.id,buffer:(e=this.files)!=null&&e.length?await this.packTar():null,repository:this.repository,branch:this.branch,dockerComposeFile:this.dockerComposeFile,adjustVolumes:this.adjustVolumes,inherit:this.inherit});console.log("res",t)}catch(t){console.log("error",t)}},async update(){var e;try{const t=await this.io.service("apps").update(this.id,{buffer:(e=this.files)!=null&&e.length?await this.packTar():null,repository:this.repository,dockerComposeFile:this.dockerComposeFile,inherit:this.inherit,adjustVolumes:this.adjustVolumes,branch:this.branch,name:this.name});console.log("res",t)}catch(t){console.log("error",t)}},async packTar(){let e=new T;for await(let t of this.files)e.append(t.name,new Uint8Array(t.buffer));return e.out},async resolveDockerCompose(){const e=this.files.find(t=>t.name.endsWith("docker-compose.yml"));if(e){const t=new TextDecoder().decode(e.buffer);this.dockerComposeFile=t}},async uploadZip(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!1,t.accept=".zip",t.onchange=async()=>{let r=Array.from(t.files)[0];const{entries:l}=await q(await r.arrayBuffer());for await(const[c,i]of Object.entries(l))l[c].isDirectory||this.files.push({buffer:await i.arrayBuffer(),name:c});await this.resolveDockerCompose(),e()},t.click()})},async uploadTar(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!1,t.accept=".tar",t.onchange=async()=>{let r=Array.from(t.files)[0],l=await z(await r.arrayBuffer());for await(let c of l)this.files.push({buffer:c.buffer,name:c.name});await this.resolveDockerCompose(),e()},t.click()})},async uploadFolder(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!0,t.webkitdirectory=!0,t.dir=!0,t.onchange=async()=>{let r=Array.from(t.files);for await(let l of r)this.files.push({buffer:await l.arrayBuffer(),name:l.webkitRelativePath});await this.resolveDockerCompose(),e()},t.click()})},async uploadFiles(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!0,t.onchange=async()=>{let r=Array.from(t.files);for await(let l of r){let c=await l.arrayBuffer();this.files.push({buffer:c,name:"root/"+l.name})}await this.resolveDockerCompose(),e()},t.click()})}}},f=e=>(E("data-v-cf2eaf1c"),e=e(),W(),e),M={class:"font-thin text-xl lg:text-3xl xl:pl-6 w-full text-center uppercase"},Z={class:"mt-8 mb-20 relative overflow-auto w-full"},K={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},L=f(()=>o("label",{class:"block my-2"}," Basic app settings ",-1)),Y={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},G=f(()=>o("label",{class:"block my-2"}," Upload using drop of Tar / Zip / Folder / Docker Compose File / Docker File ",-1)),J={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},Q={class:"block my-2"},X={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},x=f(()=>o("label",{class:"block my-2"}," Clone using a git provider ",-1)),_={class:"mr-4 inline-block"},ee=["onClick"],te={key:0},se={class:"block my-2"},oe=["value"],re={class:"block my-2"},ie=["value"],ae={class:"block my-2"},le=["value"],ne=f(()=>o("label",{class:"block my-2"}," Repository ",-1)),ue=f(()=>o("label",{class:"block my-2"}," Branch ",-1)),pe=f(()=>o("div",{class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},[o("label",{class:"block my-2"}," One click installation browsing images from docker hub ")],-1)),de={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},ce=f(()=>o("label",{class:"block my-2"},"Docker Compose",-1)),he={class:"text-right"},me=["disabled"];function fe(e,t,r,l,c,i){const $=w("SectionHero"),P=w("WrapperPage"),U=w("TemplateDefault");return a(),N(U,{renderer:r.renderer},{default:g(()=>[D($,null,{default:g(()=>[o("h1",M,d(i.id||"Deploy Docker App"),1)]),_:1}),D(P,{class:"p-6"},{default:g(()=>{var v,C,F,j,V;return[o("div",Z,[o("div",K,[L,n(),h(o("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>e.name=s),placeholder:"Name",class:"px-4 py-2 block w-full mb-4"},null,512),[[m,e.name]]),e.$route.params.id?p("",!0):h((a(),u("input",{key:0,"onUpdate:modelValue":t[1]||(t[1]=s=>e.slug=s),placeholder:"Slug",class:"px-4 py-2 block w-full"},null,512)),[[m,e.slug]]),n(),e.$route.params.id?h((a(),u("input",{key:1,"onUpdate:modelValue":t[2]||(t[2]=s=>i.id=s),placeholder:"Slug",readonly:"",class:"px-4 py-2 block w-full"},null,512)),[[m,i.id]]):p("",!0)]),o("div",Y,[G,o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[3]||(t[3]=s=>i.uploadFiles())}," Upload files "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[4]||(t[4]=s=>e.uploadFolde())}," Upload folder "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[5]||(t[5]=s=>i.uploadTar())}," Upload tar "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[6]||(t[6]=s=>i.uploadZip())}," Upload zip ")]),o("div",J,[o("label",Q," Files count: "+d(e.files.length),1)]),o("div",X,[x,(a(!0),u(b,null,y(i.oauthProvidersFiltered,s=>(a(),u("div",_,[o("button",{class:"rounded p-2 bg-slate-200 mr-1",onClick:A=>i.consent(s.consent_url)}," Connect to "+d(s.provider),9,ee),n(),o("button",{class:"rounded p-2 bg-slate-200",onClick:t[7]||(t[7]=A=>e.searchRepos=!e.searchRepos)},d(e.searchRepos?"Close":"Select repository"),1)]))),256)),e.searchRepos?(a(),u("div",te,[o("label",se," Select user / organisation ("+d(((v=i.orgs)==null?void 0:v.length)||"0")+") ",1),n(),h(o("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>e.query=s),class:"mt-2 px-4 py-2 w-full"},[(a(!0),u(b,null,y(i.orgs,s=>(a(),u("option",{value:s.query},d(s.title),9,oe))),256))],512),[[k,e.query]]),n(),h(o("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>e.search=s),placeholder:"Search for repository ...",class:"mt-2 px-4 py-2 w-full",onKeypress:t[10]||(t[10]=O(s=>i.getRepositories(),["enter"]))},null,544),[[m,e.search]]),n(),o("button",{class:"rounded p-2 mt-2 w-full bg-slate-200",onClick:t[11]||(t[11]=s=>i.getRepositories())}," Search "),n(),o("label",re," Select Repository ("+d(((F=(C=e.repositories)==null?void 0:C.items)==null?void 0:F.length)||"0")+") ",1),n(),h(o("select",{"onUpdate:modelValue":t[12]||(t[12]=s=>e.repository=s),class:"mt-2 px-4 py-2 w-full"},[(a(!0),u(b,null,y((j=e.repositories)==null?void 0:j.items,s=>(a(),u("option",{value:s.clone_url},d(s.full_name),9,ie))),256))],512),[[k,e.repository]]),n(),o("label",ae," Select Branch ("+d(((V=e.branches)==null?void 0:V.length)||"0")+") ",1),n(),h(o("select",{"onUpdate:modelValue":t[13]||(t[13]=s=>e.branch=s),class:"mt-2 px-4 py-2 w-full"},[(a(!0),u(b,null,y(e.branches,s=>(a(),u("option",{value:s.name},d(s.name),9,le))),256))],512),[[k,e.branch]])])):p("",!0),n(),ne,n(),h(o("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>e.repository=s),placeholder:"Repository url",class:"mt-2 px-4 py-2 w-full"},null,512),[[m,e.repository]]),n(),ue,n(),h(o("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>e.branch=s),placeholder:"Branch",class:"mt-2 px-4 py-2 w-full"},null,512),[[m,e.branch]]),n(),o("button",{class:"rounded p-2 bg-slate-200 mt-2",onClick:t[16]||(t[16]=s=>e.adjustVolumes=!e.adjustVolumes)}," Move volumes to app folder: "+d(e.adjustVolumes?"Yes":"No"),1)]),pe,o("div",de,[ce,o("button",{class:"rounded p-2 bg-slate-200 my-4",onClick:t[17]||(t[17]=s=>e.inherit=!e.inherit)}," Inherit original docker-compose file: "+d(e.inherit?"Yes":"No"),1),n(),h(o("textarea",{class:"w-full p-4","onUpdate:modelValue":t[18]||(t[18]=s=>e.dockerComposeFile=s),rows:"10",placeholder:"docker-compose.override.yml"},null,512),[[m,e.dockerComposeFile]])]),o("div",he,[e.$route.params.id?p("",!0):(a(),u("button",{key:0,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",disabled:!e.slug,onClick:t[19]||(t[19]=s=>i.deploy())}," Launch ",8,me)),e.$route.params.id?(a(),u("button",{key:1,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[20]||(t[20]=s=>i.update())}," Update ")):p("",!0),!e.webhook&&e.$route.params.id&&e.repository?(a(),u("button",{key:2,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[21]||(t[21]=s=>i.attach())}," Attach webhook ")):p("",!0),e.webhook&&e.$route.params.id&&e.repository?(a(),u("button",{key:3,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[22]||(t[22]=s=>i.detach())}," Detach webhook ")):p("",!0),!e.running&&e.$route.params.id?(a(),u("button",{key:4,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[23]||(t[23]=s=>i.start())}," Start ")):p("",!0),n(),e.running&&e.$route.params.id?(a(),u("button",{key:5,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[24]||(t[24]=s=>i.stop())}," Stop ")):p("",!0),n(),e.$route.params.id?(a(),u("button",{key:6,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[25]||(t[25]=s=>i.build())}," Build ")):p("",!0),n(),e.$route.params.id?(a(),u("button",{key:7,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[26]||(t[26]=s=>i.destroy())}," Destroy ")):p("",!0),n(),e.$route.params.id?(a(),u("button",{key:8,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[27]||(t[27]=s=>i.compose())}," Compose ")):p("",!0),n(),e.$route.params.id?(a(),u("button",{key:9,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[28]||(t[28]=s=>i.remove())}," Remove ")):p("",!0)])])]}),_:1})]),_:1},8,["renderer"])}const ve=I(H,[["render",fe],["__scopeId","data-v-cf2eaf1c"]]);export{ve as default};
