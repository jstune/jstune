import{W as S}from"./UtilityNavbar-UYM_dXUk.js";import A from"./TemplateDefault-N2drX_Om.js";import{S as R}from"./SectionHero-D7xl8Fu_.js";import{T,u as q,a as z}from"./unzipit.module-ah5dLdXx.js";import{_ as I,c as N,w as g,r as w,o as a,a as U,b as o,t as d,d as l,e as h,v as m,g as n,k as p,h as y,F as b,f as k,j as O,p as E,l as W}from"./index-BZQySXPW.js";const H={components:{WrapperPage:S,TemplateDefault:A,SectionHero:R},props:["renderer"],inject:["io"],data:()=>({dockerComposeFile:"",files:[],name:"",slug:"",repository:"",branch:"",branches:[],adjustVolumes:!0,inherit:!0,running:!1,webhook:!1,searchRepos:!1,oauthProviders:[],consentUrl:"",search:"",user:null,query:"",organisations:[],repositories:null}),watch:{async searchRepos(e){e&&(await this.getOAuthProviders(),await this.getUser(),await this.getOrganisations(),!this.query&&this.orgs.length&&(this.query=this.orgs[0].query,await this.getRepositories()))},async query(){await this.getRepositories()},async repository(e){var r;const s=(r=this.repositories)==null?void 0:r.items.find(u=>u.clone_url===e);s&&(this.branch=s.default_branch,await this.getBranches(s))}},computed:{id(){return this.$route.params.id||this.slug},oauthProvidersFiltered(){const e=["github"];return this.oauthProviders.filter(s=>e.includes(s.provider))},orgs(){var e,s;return[{title:(e=this.user)==null?void 0:e.login,query:`user:${(s=this.user)==null?void 0:s.login}`},...this.organisations.map(r=>{var u,c;return{title:(u=r==null?void 0:r.organization)==null?void 0:u.login,query:`org:${(c=r==null?void 0:r.organization)==null?void 0:c.login}`}})]}},async created(){await this.getOAuthProviders(),this.id&&await this.getItem()},methods:{async getUser(){const e=this.oauthProvidersFiltered.find(s=>s.provider==="github");if(e){let s=await fetch("https://api.github.com/user",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.user=await s.json(),console.log("user",this.user)}},async getOrganisations(){const e=this.oauthProvidersFiltered.find(s=>s.provider==="github");if(e){let s=await fetch("https://api.github.com/user/memberships/orgs?per_page=150",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.organisations=await s.json(),console.log("orgs",this.organisations)}},async getRepositories(){const e=this.oauthProvidersFiltered.find(s=>s.provider==="github");if(e){let s="q="+encodeURIComponent(this.search+(" "+this.query||" user:"+this.user.login)),r=await fetch(`https://api.github.com/search/repositories?${s}&per_page=150`,{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.repositories=await r.json(),console.log("repos",this.repositories)}},async getBranches(e){const s=this.oauthProvidersFiltered.find(r=>r.provider==="github");if(s){let r=await fetch(e.branches_url.replace("{/branch}","")+"?per_page=150",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${s.token}`}});this.branches=await r.json(),console.log("branches",this.branches)}},consent(e){e&&window.open(e,"_blank")},async getOAuthProviders(){const e=await this.io.service("oauth_providers").find({query:{}});this.oauthProviders=e==null?void 0:e.data},async getItem(){const e=await this.io.service("apps").get(this.id);this.name=e.name,this.slug=e.id,this.repository=e.repository,this.branch=e.branch,this.adjustVolumes=e.adjustVolumes,this.inherit=e.inherit,this.running=e.running,this.dockerComposeFile=e.dockerComposeFile,this.webhook=e.webhook,console.log(e)},async remove(){const e=await this.io.service("apps").remove(this.id);console.log("res",e)},async attach(){const e=await this.io.service("apps").patch(this.id,{attach:!0});console.log("res",e)},async detach(){const e=await this.io.service("apps").patch(this.id,{detach:!0});console.log("res",e)},async status(){const e=await this.io.service("apps").patch(this.id,{status:!0});console.log("res",e)},async start(){const e=await this.io.service("apps").patch(this.id,{start:!0});console.log("res",e)},async stop(){const e=await this.io.service("apps").patch(this.id,{stop:!0});console.log("res",e)},async build(){const e=await this.io.service("apps").patch(this.id,{build:!0});console.log("res",e)},async destroy(){const e=await this.io.service("apps").patch(this.id,{destroy:!0});console.log("res",e)},async compose(){const e=await this.io.service("apps").patch(this.id,{compose:this.dockerComposeFile});console.log("res",e)},async deploy(){var e;try{console.log("files",this.files);const s=await this.io.service("apps").create({name:this.name,slug:this.id,buffer:(e=this.files)!=null&&e.length?await this.packTar():null,repository:this.repository,branch:this.branch,dockerComposeFile:this.dockerComposeFile,adjustVolumes:this.adjustVolumes,inherit:this.inherit});console.log("res",s)}catch(s){console.log("error",s)}},async update(){var e;try{const s=await this.io.service("apps").update(this.id,{buffer:(e=this.files)!=null&&e.length?await this.packTar():null,repository:this.repository,dockerComposeFile:this.dockerComposeFile,inherit:this.inherit,adjustVolumes:this.adjustVolumes,branch:this.branch,name:this.name});console.log("res",s)}catch(s){console.log("error",s)}},async packTar(){let e=new T;for await(let s of this.files)e.append(s.name,new Uint8Array(s.buffer));return e.out},async resolveDockerCompose(){const e=this.files.find(s=>s.name.endsWith("docker-compose.yml"));if(e){const s=new TextDecoder().decode(e.buffer);this.dockerComposeFile=s}},async uploadZip(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let s=document.createElement("input");s.type="file",s.multiple=!1,s.accept=".zip",s.onchange=async()=>{let r=Array.from(s.files)[0];const{entries:u}=await q(await r.arrayBuffer());for await(const[c,i]of Object.entries(u))u[c].isDirectory||this.files.push({buffer:await i.arrayBuffer(),name:c});await this.resolveDockerCompose(),e()},s.click()})},async uploadTar(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let s=document.createElement("input");s.type="file",s.multiple=!1,s.accept=".tar",s.onchange=async()=>{let r=Array.from(s.files)[0],u=await z(await r.arrayBuffer());for await(let c of u)this.files.push({buffer:c.buffer,name:c.name});await this.resolveDockerCompose(),e()},s.click()})},async uploadFolder(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let s=document.createElement("input");s.type="file",s.multiple=!0,s.webkitdirectory=!0,s.dir=!0,s.onchange=async()=>{let r=Array.from(s.files);for await(let u of r)this.files.push({buffer:await u.arrayBuffer(),name:u.webkitRelativePath});await this.resolveDockerCompose(),e()},s.click()})},async uploadFiles(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let s=document.createElement("input");s.type="file",s.multiple=!0,s.onchange=async()=>{let r=Array.from(s.files);for await(let u of r){let c=await u.arrayBuffer();this.files.push({buffer:c,name:"root/"+u.name})}await this.resolveDockerCompose(),e()},s.click()})}}},f=e=>(E("data-v-933dbad6"),e=e(),W(),e),M={class:"font-thin text-xl lg:text-3xl xl:pl-6 w-full text-center uppercase"},Z={class:"mt-8 mb-20 relative overflow-auto w-full"},K={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},L=f(()=>o("label",{class:"block my-2"}," Basic app settings ",-1)),Y={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},G=f(()=>o("label",{class:"block my-2"}," Upload using drop of Tar / Zip / Folder / Docker Compose File / Docker File ",-1)),J={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},Q={class:"block my-2"},X={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},x=f(()=>o("label",{class:"block my-2"}," Clone using a git provider ",-1)),_={class:"mr-4 inline-block"},ee=["onClick"],se={key:0},te={class:"block my-2"},oe=["value"],re={class:"block my-2"},ie=["value"],ae={class:"block my-2"},le=["value"],ne=f(()=>o("label",{class:"block my-2"}," Repository ",-1)),ue=f(()=>o("label",{class:"block my-2"}," Branch ",-1)),pe=f(()=>o("div",{class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},[o("label",{class:"block my-2"}," One click installation browsing images from docker hub ")],-1)),de={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},ce=f(()=>o("label",{class:"block my-2"},"Docker Compose",-1)),he={class:"text-right"},me=["disabled"];function fe(e,s,r,u,c,i){const $=w("SectionHero"),D=w("WrapperPage"),P=w("TemplateDefault");return a(),N(P,{renderer:r.renderer},{default:g(()=>[U($,null,{default:g(()=>[o("h1",M,d(i.id||"Deploy Docker App"),1)]),_:1}),U(D,{class:"p-6"},{default:g(()=>{var v,C,F,V,j;return[o("div",Z,[o("div",K,[L,l(),h(o("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>e.name=t),placeholder:"Name",class:"px-4 py-2 block w-full mb-4"},null,512),[[m,e.name]]),e.$route.params.id?p("",!0):h((a(),n("input",{key:0,"onUpdate:modelValue":s[1]||(s[1]=t=>e.slug=t),placeholder:"Slug",class:"px-4 py-2 block w-full"},null,512)),[[m,e.slug]]),l(),e.$route.params.id?h((a(),n("input",{key:1,"onUpdate:modelValue":s[2]||(s[2]=t=>i.id=t),placeholder:"Slug",readonly:"",class:"px-4 py-2 block w-full"},null,512)),[[m,i.id]]):p("",!0)]),o("div",Y,[G,o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:s[3]||(s[3]=t=>i.uploadFiles())}," Upload files "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:s[4]||(s[4]=t=>e.uploadFolde())}," Upload folder "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:s[5]||(s[5]=t=>i.uploadTar())}," Upload tar "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:s[6]||(s[6]=t=>i.uploadZip())}," Upload zip ")]),o("div",J,[o("label",Q," Files count: "+d(e.files.length),1)]),o("div",X,[x,(a(!0),n(b,null,y(i.oauthProvidersFiltered,t=>(a(),n("div",_,[o("button",{class:"rounded p-2 bg-slate-200 mr-1",onClick:B=>i.consent(t.consent_url)}," Connect to "+d(t.provider),9,ee),l(),o("button",{class:"rounded p-2 bg-slate-200",onClick:s[7]||(s[7]=B=>e.searchRepos=!e.searchRepos)},d(e.searchRepos?"Close":"Select repository"),1)]))),256)),e.searchRepos?(a(),n("div",se,[o("label",te," Select user / organisation ("+d(((v=i.orgs)==null?void 0:v.length)||"0")+") ",1),l(),h(o("select",{"onUpdate:modelValue":s[8]||(s[8]=t=>e.query=t),class:"mt-2 px-4 py-2 w-full"},[(a(!0),n(b,null,y(i.orgs,t=>(a(),n("option",{value:t.query},d(t.title),9,oe))),256))],512),[[k,e.query]]),l(),h(o("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>e.search=t),placeholder:"Search for repository ...",class:"mt-2 px-4 py-2 w-full",onKeypress:s[10]||(s[10]=O(t=>i.getRepositories(),["enter"]))},null,544),[[m,e.search]]),l(),o("button",{class:"rounded p-2 mt-2 w-full bg-slate-200",onClick:s[11]||(s[11]=t=>i.getRepositories())}," Search "),l(),o("label",re," Select Repository ("+d(((F=(C=e.repositories)==null?void 0:C.items)==null?void 0:F.length)||"0")+") ",1),l(),h(o("select",{"onUpdate:modelValue":s[12]||(s[12]=t=>e.repository=t),class:"mt-2 px-4 py-2 w-full"},[(a(!0),n(b,null,y((V=e.repositories)==null?void 0:V.items,t=>(a(),n("option",{value:t.clone_url},d(t.full_name),9,ie))),256))],512),[[k,e.repository]]),l(),o("label",ae," Select Branch ("+d(((j=e.branches)==null?void 0:j.length)||"0")+") ",1),l(),h(o("select",{"onUpdate:modelValue":s[13]||(s[13]=t=>e.branch=t),class:"mt-2 px-4 py-2 w-full"},[(a(!0),n(b,null,y(e.branches,t=>(a(),n("option",{value:t.name},d(t.name),9,le))),256))],512),[[k,e.branch]])])):p("",!0),l(),ne,l(),h(o("input",{"onUpdate:modelValue":s[14]||(s[14]=t=>e.repository=t),placeholder:"Repository url",class:"mt-2 px-4 py-2 w-full"},null,512),[[m,e.repository]]),l(),ue,l(),h(o("input",{"onUpdate:modelValue":s[15]||(s[15]=t=>e.branch=t),placeholder:"Branch",class:"mt-2 px-4 py-2 w-full"},null,512),[[m,e.branch]]),l(),o("button",{class:"rounded p-2 bg-slate-200 mt-2",onClick:s[16]||(s[16]=t=>e.adjustVolumes=!e.adjustVolumes)}," Move volumes to app folder: "+d(e.adjustVolumes?"Yes":"No"),1)]),pe,o("div",de,[ce,o("button",{class:"rounded p-2 bg-slate-200 my-4",onClick:s[17]||(s[17]=t=>e.inherit=!e.inherit)}," Inherit original docker-compose file: "+d(e.inherit?"Yes":"No"),1),l(),h(o("textarea",{class:"w-full p-4","onUpdate:modelValue":s[18]||(s[18]=t=>e.dockerComposeFile=t),rows:"10",placeholder:"docker-compose.override.yml"},null,512),[[m,e.dockerComposeFile]])]),o("div",he,[e.$route.params.id?p("",!0):(a(),n("button",{key:0,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",disabled:!e.slug,onClick:s[19]||(s[19]=t=>i.deploy())}," Launch ",8,me)),e.$route.params.id?(a(),n("button",{key:1,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:s[20]||(s[20]=t=>i.update())}," Update ")):p("",!0),!e.webhook&&e.$route.params.id&&e.repository?(a(),n("button",{key:2,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:s[21]||(s[21]=t=>i.attach())}," Attach webhook ")):p("",!0),e.webhook&&e.$route.params.id&&e.repository?(a(),n("button",{key:3,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:s[22]||(s[22]=t=>i.detach())}," Detach webhook ")):p("",!0),!e.running&&e.$route.params.id?(a(),n("button",{key:4,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:s[23]||(s[23]=t=>i.start())}," Start ")):p("",!0),l(),e.running&&e.$route.params.id?(a(),n("button",{key:5,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:s[24]||(s[24]=t=>i.stop())}," Stop ")):p("",!0),l(),e.$route.params.id?(a(),n("button",{key:6,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:s[25]||(s[25]=t=>i.build())}," Build ")):p("",!0),l(),e.$route.params.id?(a(),n("button",{key:7,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:s[26]||(s[26]=t=>i.destroy())}," Destroy ")):p("",!0),l(),e.$route.params.id?(a(),n("button",{key:8,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:s[27]||(s[27]=t=>i.compose())}," Compose ")):p("",!0),l(),e.$route.params.id?(a(),n("button",{key:9,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:s[28]||(s[28]=t=>i.remove())}," Remove ")):p("",!0)])])]}),_:1})]),_:1},8,["renderer"])}const ve=I(H,[["render",fe],["__scopeId","data-v-933dbad6"]]);export{ve as default};
