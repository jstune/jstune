import{W as q}from"./UtilityNavbar-CsXnxQ0K.js";import T from"./TemplateDefault-C7lMCOIQ.js";import{S as $}from"./SectionHero-CymPkmEZ.js";import{T as I,u as V,a as j}from"./unzipit.module-DIkFKNhF.js";import{_ as z,c as O,w as b,r as y,o as r,a as B,b as o,t as p,d as g,e as c,v as h,g as n,k as d,h as f,F as m,f as w,j as E,p as H,l as N}from"./index-CwdNm52j.js";const W={components:{WrapperPage:q,TemplateDefault:T,SectionHero:$},props:["renderer"],inject:["io"],data:()=>({files:[],hostname:"",repository:"",branch:"",branches:[],webhook:!1,searchRepos:!1,oauthProviders:[],consentUrl:"",search:"",user:null,query:"",organisations:[],repositories:null}),watch:{async searchRepos(t){t&&(await this.getOAuthProviders(),await this.getUser(),await this.getOrganisations(),!this.query&&this.orgs.length&&(this.query=this.orgs[0].query,await this.getRepositories()))},async query(){await this.getRepositories()},async repository(t){var a;const e=(a=this.repositories)==null?void 0:a.items.find(l=>l.clone_url===t);e&&(this.branch=e.default_branch,await this.getBranches(e))}},computed:{id(){return this.$route.params.id||this.hostname},oauthProvidersFiltered(){const t=["github"];return this.oauthProviders.filter(e=>t.includes(e.provider))},orgs(){var t,e;return[{title:(t=this.user)==null?void 0:t.login,query:`user:${(e=this.user)==null?void 0:e.login}`},...this.organisations.map(a=>{var l,u;return{title:(l=a==null?void 0:a.organization)==null?void 0:l.login,query:`org:${(u=a==null?void 0:a.organization)==null?void 0:u.login}`}})]}},async created(){await this.getOAuthProviders(),this.id?await this.getItem():this.branch="main"},methods:{async getUser(){const t=this.oauthProvidersFiltered.find(e=>e.provider==="github");if(t){let e=await fetch("https://api.github.com/user",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${t.token}`}});this.user=await e.json(),console.log("user",this.user)}},async getOrganisations(){const t=this.oauthProvidersFiltered.find(e=>e.provider==="github");if(t){let e=await fetch("https://api.github.com/user/memberships/orgs?per_page=150",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${t.token}`}});this.organisations=await e.json(),console.log("orgs",this.organisations)}},async getRepositories(){const t=this.oauthProvidersFiltered.find(e=>e.provider==="github");if(t){let e="q="+encodeURIComponent(this.search+(" "+this.query||" user:"+this.user.login)),a=await fetch(`https://api.github.com/search/repositories?${e}&per_page=150`,{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${t.token}`}});this.repositories=await a.json(),console.log("repos",this.repositories)}},async getBranches(t){const e=this.oauthProvidersFiltered.find(a=>a.provider==="github");if(e){let a=await fetch(t.branches_url.replace("{/branch}","")+"?per_page=150",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.branches=await a.json(),console.log("branches",this.branches)}},consent(t){t&&window.open(t,"_blank")},async getOAuthProviders(){const t=await this.io.service("oauth_providers").find({query:{}});this.oauthProviders=t==null?void 0:t.data},async getItem(){const t=await this.io.service("static").get(this.id);this.hostname=t.id,this.repository=t.repository,this.branch=t.branch,this.webhook=t.webhook,console.log("res",t)},async remove(){const t=await this.io.service("static").remove(this.id);console.log("res",t),this.$router.push("/apps-static")},async attach(){const t=await this.io.service("static").patch(this.id,{attach:!0});console.log("res",t),await this.getItem()},async detach(){const t=await this.io.service("static").patch(this.id,{detach:!0});console.log("res",t),await this.getItem()},async status(){const t=await this.io.service("static").patch(this.id,{status:!0});console.log("res",t),await this.getItem()},async update(){var t;try{console.log("files",this.files);const e=await this.io.service("static").update(this.id,{buffer:(t=this.files)!=null&&t.length?await this.packTar():null,repository:this.repository,branch:this.branch});console.log("res",e),await this.getItem()}catch(e){console.log("error",e)}},async deploy(){var t;try{console.log("files",this.files);const e=await this.io.service("static").create({hostname:this.id,buffer:(t=this.files)!=null&&t.length?await this.packTar():null,repository:this.repository,branch:this.branch});console.log("res",e),await this.getItem()}catch(e){console.log("error",e)}},async packTar(){let t=new I;for await(let e of this.files)t.append(e.name,new Uint8Array(e.buffer));return t.out},async uploadZip(){return this.files=[],new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!1,e.accept=".zip",e.onchange=async()=>{let a=Array.from(e.files)[0];const{entries:l}=await V(await a.arrayBuffer());for await(const[u,i]of Object.entries(l))l[u].isDirectory||this.files.push({buffer:await i.arrayBuffer(),name:u});await this.resolveDockerCompose(),t()},e.click()})},async uploadTar(){return this.files=[],new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!1,e.accept=".tar",e.onchange=async()=>{let a=Array.from(e.files)[0],l=await j(await a.arrayBuffer());for await(let u of l)this.files.push({buffer:u.buffer,name:u.name});await this.resolveDockerCompose(),t()},e.click()})},async uploadFolder(){return this.files=[],new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!0,e.webkitdirectory=!0,e.dir=!0,e.onchange=async()=>{let a=Array.from(e.files);for await(let l of a)this.files.push({buffer:await l.arrayBuffer(),name:l.webkitRelativePath});await this.resolveDockerCompose(),t()},e.click()})},async uploadFiles(){return this.files=[],new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!0,e.onchange=async()=>{let a=Array.from(e.files);for await(let l of a){let u=await l.arrayBuffer();this.files.push({buffer:u,name:"root/"+l.name})}await this.resolveDockerCompose(),t()},e.click()})}}},v=t=>(H("data-v-cb3ca20a"),t=t(),N(),t),Z={class:"font-thin text-xl lg:text-3xl xl:pl-6 w-full text-center uppercase"},K={class:"mt-8 mb-20 relative overflow-auto w-full"},L={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},M=v(()=>o("label",{class:"block my-2"}," Basic app settings ",-1)),G={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},J=v(()=>o("label",{class:"block my-2"}," Upload using drop of Tar / Zip / Folder / Docker Compose File / Docker File ",-1)),Q={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},X={class:"block my-2"},Y={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},_=v(()=>o("label",{class:"block my-2"}," Clone using a git provider ",-1)),x={class:"mr-4 inline-block"},ee=["onClick"],te={key:0},se={class:"block my-2"},oe=["value"],ae={class:"block my-2"},ie=["value"],re={class:"block my-2"},le=["value"],ne={class:"text-right"},ue=["disabled"];function pe(t,e,a,l,u,i){const S=y("SectionHero"),F=y("WrapperPage"),R=y("TemplateDefault");return r(),O(R,{renderer:a.renderer},{default:b(()=>[B(S,null,{default:b(()=>[o("h1",Z,p(i.id?i.id:"Deploy Static App"),1)]),_:1}),B(F,{class:"p-6"},{default:b(()=>{var k,C,P,U,A;return[o("div",K,[o("div",L,[M,g(),t.$route.params.id?d("",!0):c((r(),n("input",{key:0,"onUpdate:modelValue":e[0]||(e[0]=s=>t.hostname=s),placeholder:"Hostname",class:"px-4 py-2 block w-full mb-4"},null,512)),[[h,t.hostname]]),g(),t.$route.params.id?c((r(),n("input",{key:1,"onUpdate:modelValue":e[1]||(e[1]=s=>i.id=s),placeholder:"Hostname",readonly:"",class:"px-4 py-2 block w-full mb-4"},null,512)),[[h,i.id]]):d("",!0)]),o("div",G,[J,o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[2]||(e[2]=s=>i.uploadFiles())}," Upload files "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[3]||(e[3]=s=>t.uploadFolde())}," Upload folder "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[4]||(e[4]=s=>i.uploadTar())}," Upload tar "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[5]||(e[5]=s=>i.uploadZip())}," Upload zip "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[6]||(e[6]=s=>t.files=[])}," Clear files ")]),o("div",Q,[o("label",X," Files count: "+p(t.files.length),1)]),o("div",Y,[_,(r(!0),n(m,null,f(i.oauthProvidersFiltered,s=>(r(),n("div",x,[o("button",{class:"rounded p-2 bg-slate-200 mr-1",onClick:D=>i.consent(s.consent_url)}," Connect to "+p(s.provider),9,ee),o("button",{class:"rounded p-2 bg-slate-200",onClick:e[7]||(e[7]=D=>t.searchRepos=!t.searchRepos)},p(t.searchRepos?"Close":"Select repository"),1)]))),256)),t.searchRepos?(r(),n("div",te,[o("label",se," Select user / organisation ("+p(((k=i.orgs)==null?void 0:k.length)||"0")+") ",1),c(o("select",{"onUpdate:modelValue":e[8]||(e[8]=s=>t.query=s),class:"mt-2 px-4 py-2 w-full"},[(r(!0),n(m,null,f(i.orgs,s=>(r(),n("option",{value:s.query},p(s.title),9,oe))),256))],512),[[w,t.query]]),c(o("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>t.search=s),placeholder:"Search for repository ...",class:"mt-2 px-4 py-2 w-full",onKeypress:e[10]||(e[10]=E(s=>i.getRepositories(),["enter"]))},null,544),[[h,t.search]]),o("button",{class:"rounded p-2 mt-2 w-full bg-slate-200",onClick:e[11]||(e[11]=s=>i.getRepositories())}," Search "),o("label",ae," Select Repository ("+p(((P=(C=t.repositories)==null?void 0:C.items)==null?void 0:P.length)||"0")+") ",1),c(o("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>t.repository=s),class:"mt-2 px-4 py-2 w-full"},[(r(!0),n(m,null,f((U=t.repositories)==null?void 0:U.items,s=>(r(),n("option",{value:s.clone_url},p(s.full_name),9,ie))),256))],512),[[w,t.repository]]),o("label",re," Select Branch ("+p(((A=t.branches)==null?void 0:A.length)||"0")+") ",1),c(o("select",{"onUpdate:modelValue":e[13]||(e[13]=s=>t.branch=s),class:"mt-2 px-4 py-2 w-full"},[(r(!0),n(m,null,f(t.branches,s=>(r(),n("option",{value:s.name},p(s.name),9,le))),256))],512),[[w,t.branch]])])):d("",!0),c(o("input",{"onUpdate:modelValue":e[14]||(e[14]=s=>t.repository=s),placeholder:"Repository url",class:"mt-2 px-4 py-2 w-full"},null,512),[[h,t.repository]]),g(),c(o("input",{"onUpdate:modelValue":e[15]||(e[15]=s=>t.branch=s),placeholder:"Branch name",class:"mt-2 px-4 py-2 w-full"},null,512),[[h,t.branch]])]),o("div",ne,[t.$route.params.id?d("",!0):(r(),n("button",{key:0,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",disabled:!t.hostname,onClick:e[16]||(e[16]=s=>i.deploy())}," Launch ",8,ue)),t.$route.params.id?(r(),n("button",{key:1,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[17]||(e[17]=s=>i.update())}," Update ")):d("",!0),!t.webhook&&t.repository?(r(),n("button",{key:2,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[18]||(e[18]=s=>i.attach())}," Attach webhook ")):d("",!0),t.webhook&&t.repository?(r(),n("button",{key:3,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[19]||(e[19]=s=>i.detach())}," Detach webhook ")):d("",!0),t.$route.params.id?(r(),n("button",{key:4,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[20]||(e[20]=s=>i.remove())}," Remove ")):d("",!0)])])]}),_:1})]),_:1},8,["renderer"])}const be=z(W,[["render",pe],["__scopeId","data-v-cb3ca20a"]]);export{be as default};
