import{W as B}from"./UtilityNavbar-BgNQRm0G.js";import S from"./TemplateDefault-vNknsRHy.js";import{S as I}from"./SectionHero-DDy7CLTS.js";import{T as R,u as T,a as q}from"./unzipit.module-CHgijPbJ.js";import{_ as z,c as N,w as b,r as w,o as r,a as $,b as o,t as u,g as l,k as d,d as p,e as c,v as m,h as f,F as y,f as k,j as O,p as E,l as W}from"./index-D4VooVI-.js";const H={components:{WrapperPage:B,TemplateDefault:S,SectionHero:I},props:["renderer"],inject:["io"],data:()=>({dockerComposeFile:"",files:[],name:"",slug:"",repository:"",branch:"",branches:[],adjustVolumes:!0,inherit:!0,running:!1,webhook:!1,searchRepos:!1,oauthProviders:[],consentUrl:"",search:"",user:null,query:"",organisations:[],repositories:null,loading:""}),watch:{async searchRepos(e){e&&(await this.getOAuthProviders(),await this.getUser(),await this.getOrganisations(),!this.query&&this.orgs.length&&(this.query=this.orgs[0].query,await this.getRepositories()))},async query(){await this.getRepositories()},async repository(e){var i;const t=(i=this.repositories)==null?void 0:i.items.find(n=>n.clone_url===e);t&&(this.branch=t.default_branch,await this.getBranches(t),await this.getDockerCompose(t))},async branch(e){var i;const t=(i=this.repositories)==null?void 0:i.items.find(n=>n.clone_url===this.repository);t&&await this.getDockerCompose(t)}},computed:{id(){return this.$route.params.id||this.slug},oauthProvidersFiltered(){const e=["github"];return this.oauthProviders.filter(t=>e.includes(t.provider))},orgs(){var e,t;return[{title:(e=this.user)==null?void 0:e.login,query:`user:${(t=this.user)==null?void 0:t.login}`},...this.organisations.map(i=>{var n,h;return{title:(n=i==null?void 0:i.organization)==null?void 0:n.login,query:`org:${(h=i==null?void 0:i.organization)==null?void 0:h.login}`}})]}},async created(){await this.getOAuthProviders(),this.id&&await this.getItem()},methods:{async getDockerCompose(e){this.loading="docker compose file";const t=this.oauthProvidersFiltered.find(i=>i.provider==="github");if(t)try{const n=await(await fetch(e.contents_url.replace("{+path}","docker-compose.yml")+`?ref=${this.branch}`,{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${t.token}`}})).json();n.download_url&&(this.dockerComposeFile=await(await fetch(n.download_url)).text())}catch{console.error("Could not fetch docker-compose.yml",error)}this.loading=""},async getUser(){this.loading="user";const e=this.oauthProvidersFiltered.find(t=>t.provider==="github");if(e){let t=await fetch("https://api.github.com/user",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.user=await t.json(),console.log("user",this.user)}this.loading=""},async getOrganisations(){this.loading="organisations";const e=this.oauthProvidersFiltered.find(t=>t.provider==="github");if(e){let t=await fetch("https://api.github.com/user/memberships/orgs?per_page=150",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.organisations=await t.json(),console.log("orgs",this.organisations)}this.loading=""},async getRepositories(){this.loading="repositories";const e=this.oauthProvidersFiltered.find(t=>t.provider==="github");if(e){let t="q="+encodeURIComponent(this.search+(" "+this.query||" user:"+this.user.login)),i=await fetch(`https://api.github.com/search/repositories?${t}&per_page=150`,{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${e.token}`}});this.repositories=await i.json(),console.log("repos",this.repositories)}this.loading=""},async getBranches(e){this.loading="branches";const t=this.oauthProvidersFiltered.find(i=>i.provider==="github");if(t){let i=await fetch(e.branches_url.replace("{/branch}","")+"?per_page=150",{headers:{Accept:"application/vnd.github+json",Authorization:`Bearer ${t.token}`}});this.branches=await i.json(),console.log("branches",this.branches)}this.loading=""},consent(e){e&&window.open(e,"_blank")},async getOAuthProviders(){this.loading="providers";const e=await this.io.service("oauth_providers").find({query:{}});this.oauthProviders=e==null?void 0:e.data,this.loading=""},async getItem(){this.loading="app";const e=await this.io.service("apps").get(this.id);this.name=e.name,this.slug=e.id,this.repository=e.repository,this.branch=e.branch,this.adjustVolumes=e.adjustVolumes,this.inherit=e.inherit,this.running=e.running,this.dockerComposeFile=e.dockerComposeFile,this.webhook=e.webhook,console.log(e),this.loading=""},async remove(){this.loading="remove app";const e=await this.io.service("apps").remove(this.id);console.log("res",e),this.$router.push("/apps"),this.loading=""},async attach(){this.loading="attach webhook";const e=await this.io.service("apps").patch(this.id,{attach:!0});console.log("res",e),await this.getItem(),this.loading=""},async detach(){this.loading="detach webhook";const e=await this.io.service("apps").patch(this.id,{detach:!0});console.log("res",e),await this.getItem(),this.loading=""},async start(){this.loading="start app";const e=await this.io.service("apps").patch(this.id,{start:!0});console.log("res",e),await this.getItem(),this.loading=""},async stop(){this.loading="stop app";const e=await this.io.service("apps").patch(this.id,{stop:!0});console.log("res",e),await this.getItem(),this.loading=""},async build(){this.loading="build app";const e=await this.io.service("apps").patch(this.id,{build:!0});console.log("res",e),await this.getItem(),this.loading=""},async destroy(){this.loading="destroy app";const e=await this.io.service("apps").patch(this.id,{destroy:!0});console.log("res",e),await this.getItem(),this.loading=""},async compose(){this.loading="compose app";const e=await this.io.service("apps").patch(this.id,{compose:this.dockerComposeFile});console.log("res",e),await this.getItem(),this.loading=""},async deploy(){var e;this.loading="deploy app";try{console.log("files",this.files);const t=await this.io.service("apps").create({name:this.name,slug:this.id,buffer:(e=this.files)!=null&&e.length?await this.packTar():null,repository:this.repository,branch:this.branch,dockerComposeFile:this.dockerComposeFile,adjustVolumes:this.adjustVolumes,inherit:this.inherit});console.log("res",t),await this.getItem()}catch(t){console.log("error",t)}this.loading=""},async update(){var e;this.loading="update app";try{const t=await this.io.service("apps").update(this.id,{buffer:(e=this.files)!=null&&e.length?await this.packTar():null,repository:this.repository,dockerComposeFile:this.dockerComposeFile,inherit:this.inherit,adjustVolumes:this.adjustVolumes,branch:this.branch,name:this.name});console.log("res",t),await this.getItem()}catch(t){console.log("error",t)}this.loading=""},async resolveDockerCompose(){this.loading="docker compose file";const e=this.files.find(t=>t.name.endsWith("docker-compose.yml"));if(e){const t=new TextDecoder().decode(e.buffer);this.dockerComposeFile=t}this.loading=""},async packTar(){let e=new R;for await(let t of this.files)e.append(t.name,new Uint8Array(t.buffer));return e.out},async uploadZip(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!1,t.accept=".zip",t.onchange=async()=>{let i=Array.from(t.files)[0];const{entries:n}=await T(await i.arrayBuffer());for await(const[h,a]of Object.entries(n))n[h].isDirectory||this.files.push({buffer:await a.arrayBuffer(),name:h});await this.resolveDockerCompose(),e()},t.click()})},async uploadTar(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!1,t.accept=".tar",t.onchange=async()=>{let i=Array.from(t.files)[0],n=await q(await i.arrayBuffer());for await(let h of n)this.files.push({buffer:h.buffer,name:h.name});await this.resolveDockerCompose(),e()},t.click()})},async uploadFolder(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!0,t.webkitdirectory=!0,t.dir=!0,t.onchange=async()=>{let i=Array.from(t.files);for await(let n of i)this.files.push({buffer:await n.arrayBuffer(),name:n.webkitRelativePath});await this.resolveDockerCompose(),e()},t.click()})},async uploadFiles(){return this.files=[],this.dockerComposeFile="",new Promise(e=>{let t=document.createElement("input");t.type="file",t.multiple=!0,t.onchange=async()=>{let i=Array.from(t.files);for await(let n of i){let h=await n.arrayBuffer();this.files.push({buffer:h,name:"root/"+n.name})}await this.resolveDockerCompose(),e()},t.click()})}}},g=e=>(E("data-v-1c7704d4"),e=e(),W(),e),L={class:"w-full"},M={class:"font-thin text-xl lg:text-3xl xl:pl-6 w-full text-center uppercase"},Z={key:0,class:"font-thin block xl:pl-6 w-full text-center uppercase"},K={class:"mt-8 mb-20 relative overflow-auto w-full"},Y={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},G=g(()=>o("label",{class:"block my-2"}," Basic app settings ",-1)),J={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},Q=g(()=>o("label",{class:"block my-2"}," Upload using drop of Tar / Zip / Folder / Docker Compose File / Docker File ",-1)),X={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},_={class:"block my-2"},x={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},ee=g(()=>o("label",{class:"block my-2"}," Clone using a git provider ",-1)),te={class:"mr-4 inline-block"},se=["onClick"],oe={key:0},ie={class:"block my-2"},ae=["value"],re={class:"block my-2"},le=["value"],ne={class:"block my-2"},pe=["value"],de=g(()=>o("label",{class:"block my-2"}," Repository ",-1)),ue=g(()=>o("label",{class:"block my-2"}," Branch ",-1)),he=g(()=>o("div",{class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},[o("label",{class:"block my-2"}," One click installation browsing images from docker hub ")],-1)),ce={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},me=g(()=>o("label",{class:"block my-2"},"Docker Compose",-1)),ge={class:"text-right"},fe=["disabled"];function ye(e,t,i,n,h,a){const D=w("SectionHero"),P=w("WrapperPage"),U=w("TemplateDefault");return r(),N(U,{renderer:i.renderer},{default:b(()=>[$(D,null,{default:b(()=>[o("div",L,[o("h1",M,u(a.id||"Deploy Docker App"),1),e.loading?(r(),l("h2",Z," Loading - "+u(e.loading)+" ... ",1)):d("",!0)])]),_:1}),$(P,{class:"p-6"},{default:b(()=>{var v,C,F,j,V;return[o("div",K,[o("div",Y,[G,p(),c(o("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>e.name=s),placeholder:"Name",class:"px-4 py-2 block w-full mb-4"},null,512),[[m,e.name]]),e.$route.params.id?d("",!0):c((r(),l("input",{key:0,"onUpdate:modelValue":t[1]||(t[1]=s=>e.slug=s),placeholder:"Slug",class:"px-4 py-2 block w-full"},null,512)),[[m,e.slug]]),p(),e.$route.params.id?c((r(),l("input",{key:1,"onUpdate:modelValue":t[2]||(t[2]=s=>a.id=s),placeholder:"Slug",readonly:"",class:"px-4 py-2 block w-full"},null,512)),[[m,a.id]]):d("",!0)]),o("div",J,[Q,o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[3]||(t[3]=s=>a.uploadFiles())}," Upload files "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[4]||(t[4]=s=>e.uploadFolde())}," Upload folder "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[5]||(t[5]=s=>a.uploadTar())}," Upload tar "),o("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:t[6]||(t[6]=s=>a.uploadZip())}," Upload zip ")]),o("div",X,[o("label",_," Files count: "+u(e.files.length),1)]),o("div",x,[ee,(r(!0),l(y,null,f(a.oauthProvidersFiltered,s=>(r(),l("div",te,[o("button",{class:"rounded p-2 bg-slate-200 mr-1",onClick:A=>a.consent(s.consent_url)}," Connect to "+u(s.provider),9,se),p(),o("button",{class:"rounded p-2 bg-slate-200",onClick:t[7]||(t[7]=A=>e.searchRepos=!e.searchRepos)},u(e.searchRepos?"Close":"Select repository"),1)]))),256)),e.searchRepos?(r(),l("div",oe,[o("label",ie," Select user / organisation ("+u(((v=a.orgs)==null?void 0:v.length)||"0")+") ",1),p(),c(o("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>e.query=s),class:"mt-2 px-4 py-2 w-full"},[(r(!0),l(y,null,f(a.orgs,s=>(r(),l("option",{value:s.query},u(s.title),9,ae))),256))],512),[[k,e.query]]),p(),c(o("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>e.search=s),placeholder:"Search for repository ...",class:"mt-2 px-4 py-2 w-full",onKeypress:t[10]||(t[10]=O(s=>a.getRepositories(),["enter"]))},null,544),[[m,e.search]]),p(),o("button",{class:"rounded p-2 mt-2 w-full bg-slate-200",onClick:t[11]||(t[11]=s=>a.getRepositories())}," Search "),p(),o("label",re," Select Repository ("+u(((F=(C=e.repositories)==null?void 0:C.items)==null?void 0:F.length)||"0")+") ",1),p(),c(o("select",{"onUpdate:modelValue":t[12]||(t[12]=s=>e.repository=s),class:"mt-2 px-4 py-2 w-full"},[(r(!0),l(y,null,f((j=e.repositories)==null?void 0:j.items,s=>(r(),l("option",{value:s.clone_url},u(s.full_name),9,le))),256))],512),[[k,e.repository]]),p(),o("label",ne," Select Branch ("+u(((V=e.branches)==null?void 0:V.length)||"0")+") ",1),p(),c(o("select",{"onUpdate:modelValue":t[13]||(t[13]=s=>e.branch=s),class:"mt-2 px-4 py-2 w-full"},[(r(!0),l(y,null,f(e.branches,s=>(r(),l("option",{value:s.name},u(s.name),9,pe))),256))],512),[[k,e.branch]])])):d("",!0),p(),de,p(),c(o("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>e.repository=s),placeholder:"Repository url",class:"mt-2 px-4 py-2 w-full"},null,512),[[m,e.repository]]),p(),ue,p(),c(o("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>e.branch=s),placeholder:"Branch",class:"mt-2 px-4 py-2 w-full"},null,512),[[m,e.branch]]),p(),o("button",{class:"rounded p-2 bg-slate-200 mt-2",onClick:t[16]||(t[16]=s=>e.adjustVolumes=!e.adjustVolumes)}," Move volumes to app folder: "+u(e.adjustVolumes?"Yes":"No"),1)]),he,o("div",ce,[me,o("button",{class:"rounded p-2 bg-slate-200 my-4",onClick:t[17]||(t[17]=s=>e.inherit=!e.inherit)}," Inherit original docker-compose file: "+u(e.inherit?"Yes":"No"),1),p(),c(o("textarea",{class:"w-full p-4","onUpdate:modelValue":t[18]||(t[18]=s=>e.dockerComposeFile=s),rows:"10",placeholder:"docker-compose.override.yml"},null,512),[[m,e.dockerComposeFile]])]),o("div",ge,[e.$route.params.id?d("",!0):(r(),l("button",{key:0,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",disabled:!e.slug,onClick:t[19]||(t[19]=s=>a.deploy())}," Launch ",8,fe)),e.$route.params.id?(r(),l("button",{key:1,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[20]||(t[20]=s=>a.update())}," Update ")):d("",!0),!e.webhook&&e.$route.params.id&&e.repository?(r(),l("button",{key:2,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[21]||(t[21]=s=>a.attach())}," Attach webhook ")):d("",!0),e.webhook&&e.$route.params.id&&e.repository?(r(),l("button",{key:3,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[22]||(t[22]=s=>a.detach())}," Detach webhook ")):d("",!0),!e.running&&e.$route.params.id?(r(),l("button",{key:4,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[23]||(t[23]=s=>a.start())}," Start ")):d("",!0),p(),e.running&&e.$route.params.id?(r(),l("button",{key:5,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[24]||(t[24]=s=>a.stop())}," Stop ")):d("",!0),p(),e.$route.params.id?(r(),l("button",{key:6,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[25]||(t[25]=s=>a.build())}," Build ")):d("",!0),p(),e.$route.params.id?(r(),l("button",{key:7,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[26]||(t[26]=s=>a.destroy())}," Destroy ")):d("",!0),p(),e.$route.params.id?(r(),l("button",{key:8,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[27]||(t[27]=s=>a.compose())}," Compose ")):d("",!0),p(),e.$route.params.id?(r(),l("button",{key:9,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:t[28]||(t[28]=s=>a.remove())}," Remove ")):d("",!0)])])]}),_:1})]),_:1},8,["renderer"])}const Fe=z(H,[["render",ye],["__scopeId","data-v-1c7704d4"]]);export{Fe as default};
