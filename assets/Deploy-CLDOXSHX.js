import{W as v}from"./UtilityNavbar-CC9u9G3O.js";import C from"./TemplateDefault-B2607jo_.js";import{S as F}from"./SectionHero-DUV9e8TI.js";import{T as D,u as V,a as $}from"./unzipit.module-CoY57gbx.js";import{_ as j,c as T,w as h,r as y,o as a,a as b,b as s,t as f,d as p,e as m,v as c,g as i,k as r}from"./index-CpF5ohQn.js";const U={components:{WrapperPage:v,TemplateDefault:C,SectionHero:F},props:["renderer"],inject:["io"],data:()=>({dockerComposeFile:"",files:[],name:"",slug:"",repository:"",branch:"main",autodeploy:!1,adjustVolumes:!0,inherit:!0,running:!1,webhook:!1}),computed:{id(){return this.$route.params.id||this.slug}},async created(){this.id&&await this.getItem()},methods:{async getItem(){const t=await this.io.service("apps").get(this.id);this.name=t.name,this.slug=t.id,this.repository=t.repository,this.branch=t.branch,this.autodeploy=t.autodeploy,this.adjustVolumes=t.adjustVolumes,this.inherit=t.inherit,this.running=t.running,this.dockerComposeFile=t.dockerComposeFile,this.webhook=t.webhook,console.log(t)},async remove(){const t=await this.io.service("apps").remove(this.id);console.log("res",t)},async attach(){const t=await this.io.service("apps").patch(this.id,{attach:!0});console.log("res",t)},async detach(){const t=await this.io.service("apps").patch(this.id,{detach:!0});console.log("res",t)},async status(){const t=await this.io.service("apps").patch(this.id,{status:!0});console.log("res",t)},async start(){const t=await this.io.service("apps").patch(this.id,{start:!0});console.log("res",t)},async stop(){const t=await this.io.service("apps").patch(this.id,{stop:!0});console.log("res",t)},async build(){const t=await this.io.service("apps").patch(this.id,{build:!0});console.log("res",t)},async destroy(){const t=await this.io.service("apps").patch(this.id,{destroy:!0});console.log("res",t)},async compose(){const t=await this.io.service("apps").patch(this.id,{compose:this.dockerComposeFile});console.log("res",t)},async deploy(){var t;try{console.log("files",this.files);const e=await this.io.service("apps").create({name:this.name,slug:this.id,buffer:(t=this.files)!=null&&t.length?await this.packTar():null,repository:this.repository,branch:this.branch,autodeploy:this.autodeploy,dockerComposeFile:this.dockerComposeFile,adjustVolumes:this.adjustVolumes,inherit:this.inherit});console.log("res",e)}catch(e){console.log("error",e)}},async update(){var t;try{const e=await this.io.service("apps").update(this.id,{buffer:(t=this.files)!=null&&t.length?await this.packTar():null,repository:this.repository,dockerComposeFile:this.dockerComposeFile,inherit:this.inherit,adjustVolumes:this.adjustVolumes,branch:this.branch,name:this.name,autodeploy:this.autodeploy});console.log("res",e)}catch(e){console.log("error",e)}},async packTar(){let t=new D;for await(let e of this.files)t.append(e.name,new Uint8Array(e.buffer));return t.out},async resolveDockerCompose(){const t=this.files.find(e=>e.name.endsWith("docker-compose.yml"));if(t){const e=new TextDecoder().decode(t.buffer);this.dockerComposeFile=e}},async uploadZip(){return this.files=[],this.dockerComposeFile="",new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!1,e.accept=".zip",e.onchange=async()=>{let u=Array.from(e.files)[0];const{entries:n}=await V(await u.arrayBuffer());for await(const[d,l]of Object.entries(n))n[d].isDirectory||this.files.push({buffer:await l.arrayBuffer(),name:d});await this.resolveDockerCompose(),t()},e.click()})},async uploadTar(){return this.files=[],this.dockerComposeFile="",new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!1,e.accept=".tar",e.onchange=async()=>{let u=Array.from(e.files)[0],n=await $(await u.arrayBuffer());for await(let d of n)this.files.push({buffer:d.buffer,name:d.name});await this.resolveDockerCompose(),t()},e.click()})},async uploadFolder(){return this.files=[],this.dockerComposeFile="",new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!0,e.webkitdirectory=!0,e.dir=!0,e.onchange=async()=>{let u=Array.from(e.files);for await(let n of u)this.files.push({buffer:await n.arrayBuffer(),name:n.webkitRelativePath});await this.resolveDockerCompose(),t()},e.click()})},async uploadFiles(){return this.files=[],this.dockerComposeFile="",new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!0,e.onchange=async()=>{let u=Array.from(e.files);for await(let n of u){let d=await n.arrayBuffer();this.files.push({buffer:d,name:"root/"+n.name})}await this.resolveDockerCompose(),t()},e.click()})}}},B={class:"font-thin text-xl lg:text-3xl xl:pl-6 w-full text-center uppercase"},A={class:"mt-8 mb-20 relative overflow-auto w-full"},S={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},P=s("label",{class:"block my-2"}," Basic app settings ",-1),W={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},E=s("label",{class:"block my-2"}," Upload using drop of Tar / Zip / Folder / Docker Compose File / Docker File ",-1),N={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},I={class:"block my-2"},z={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},H=s("label",{class:"block my-2"}," Clone using Github (With option to autodeploy using push webhooks) ",-1),R=s("div",{class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},[s("label",{class:"block my-2"}," One click installation browsing images from docker hub ")],-1),Z={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},G=s("label",{class:"block my-2"},"Docker Compose",-1),O={class:"text-right"};function L(t,e,u,n,d,l){const k=y("SectionHero"),w=y("WrapperPage"),g=y("TemplateDefault");return a(),T(g,{renderer:u.renderer},{default:h(()=>[b(k,null,{default:h(()=>[s("h1",B,f(l.id||"Deploy Docker App"),1)]),_:1}),b(w,{class:"p-6"},{default:h(()=>[s("div",A,[s("div",S,[P,p(),m(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>t.name=o),placeholder:"Name",class:"px-4 py-2 block w-full mb-4"},null,512),[[c,t.name]]),t.$route.params.id?r("",!0):m((a(),i("input",{key:0,"onUpdate:modelValue":e[1]||(e[1]=o=>t.slug=o),placeholder:"Slug",class:"px-4 py-2 block w-full"},null,512)),[[c,t.slug]]),p(),t.$route.params.id?m((a(),i("input",{key:1,"onUpdate:modelValue":e[2]||(e[2]=o=>l.id=o),placeholder:"Slug",readonly:"",class:"px-4 py-2 block w-full"},null,512)),[[c,l.id]]):r("",!0)]),s("div",W,[E,s("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[3]||(e[3]=o=>l.uploadFiles())}," Upload files "),s("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[4]||(e[4]=o=>t.uploadFolde())}," Upload folder "),s("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[5]||(e[5]=o=>l.uploadTar())}," Upload tar "),s("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[6]||(e[6]=o=>l.uploadZip())}," Upload zip ")]),s("div",N,[s("label",I," Files count: "+f(t.files.length),1)]),s("div",z,[H,s("button",{class:"rounded p-2 bg-slate-200",onClick:e[7]||(e[7]=o=>t.connect())}," Connect to Github "),s("button",{class:"rounded p-2 bg-slate-200 ml-4",onClick:e[8]||(e[8]=o=>t.connect())}," Select repository "),s("button",{class:"rounded p-2 bg-slate-200 ml-4",onClick:e[9]||(e[9]=o=>t.autodeploy=!t.autodeploy)},f(t.autodeploy?"Autodeploy on":"Autodeploy off"),1),s("button",{class:"rounded p-2 bg-slate-200 ml-4",onClick:e[10]||(e[10]=o=>t.adjustVolumes=!t.adjustVolumes)},f(t.adjustVolumes?"Adjust volumes on":"Adjust volumes off"),1),p(),m(s("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>t.repository=o),placeholder:"Repository url",class:"mt-2 px-4 py-2 w-full"},null,512),[[c,t.repository]]),m(s("input",{"onUpdate:modelValue":e[12]||(e[12]=o=>t.branch=o),placeholder:"Branch",class:"mt-2 px-4 py-2 w-full"},null,512),[[c,t.branch]])]),R,s("div",Z,[G,s("button",{class:"rounded p-2 bg-slate-200 my-4",onClick:e[13]||(e[13]=o=>t.inherit=!t.inherit)},f(t.inherit?"Inherit original on":"Inherit original off"),1),p(),m(s("textarea",{class:"w-full p-4","onUpdate:modelValue":e[14]||(e[14]=o=>t.dockerComposeFile=o),rows:"10",placeholder:"docker-compose.override.yml"},null,512),[[c,t.dockerComposeFile]])]),s("div",O,[t.$route.params.id?r("",!0):(a(),i("button",{key:0,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[15]||(e[15]=o=>l.deploy())}," Launch ")),t.$route.params.id?(a(),i("button",{key:1,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[16]||(e[16]=o=>l.update())}," Update ")):r("",!0),!t.webhook&&t.$route.params.id?(a(),i("button",{key:2,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[17]||(e[17]=o=>l.attach())}," Attach webhook ")):r("",!0),t.webhook&&t.$route.params.id?(a(),i("button",{key:3,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[18]||(e[18]=o=>l.detach())}," Detach webhook ")):r("",!0),!t.running&&t.$route.params.id?(a(),i("button",{key:4,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[19]||(e[19]=o=>l.start())}," Start ")):r("",!0),p(),t.running&&t.$route.params.id?(a(),i("button",{key:5,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[20]||(e[20]=o=>l.stop())}," Stop ")):r("",!0),p(),t.$route.params.id?(a(),i("button",{key:6,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[21]||(e[21]=o=>l.build())}," Build ")):r("",!0),p(),t.$route.params.id?(a(),i("button",{key:7,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[22]||(e[22]=o=>l.destroy())}," Destroy ")):r("",!0),p(),t.$route.params.id?(a(),i("button",{key:8,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[23]||(e[23]=o=>l.compose())}," Compose ")):r("",!0),p(),t.$route.params.id?(a(),i("button",{key:9,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[24]||(e[24]=o=>l.remove())}," Remove ")):r("",!0)])])]),_:1})]),_:1},8,["renderer"])}const X=j(U,[["render",L]]);export{X as default};
