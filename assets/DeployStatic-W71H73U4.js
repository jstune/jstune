import{W as v}from"./UtilityNavbar-BXJOTnxS.js";import C from"./TemplateDefault-CwC9iYF_.js";import{S as D}from"./SectionHero-Q6C3S5jD.js";import{T,u as B,a as U}from"./unzipit.module-Dfp4SIg4.js";import{_ as $,c as F,w as m,r as h,o as n,a as b,b as s,t as y,d as c,e as d,v as f,g as u,k as p}from"./index-BlYx2J3Q.js";const P={components:{WrapperPage:v,TemplateDefault:C,SectionHero:D},props:["renderer"],inject:["io"],data:()=>({files:[],hostname:"",repository:"",branch:"",webhook:!1}),computed:{id(){return this.$route.params.id||this.hostname}},async created(){this.id?await this.getItem():this.branch="main"},methods:{async getItem(){const t=await this.io.service("static").get(this.id);this.hostname=t.id,this.repository=t.repository,this.branch=t.branch,this.webhook=t.webhook,console.log("res",t)},async remove(){const t=await this.io.service("static").remove(this.id);console.log("res",t)},async attach(){const t=await this.io.service("static").patch(this.id,{attach:!0});console.log("res",t)},async detach(){const t=await this.io.service("static").patch(this.id,{detach:!0});console.log("res",t)},async status(){const t=await this.io.service("static").patch(this.id,{status:!0});console.log("res",t)},async update(){var t;try{console.log("files",this.files);const e=await this.io.service("static").update(this.id,{buffer:(t=this.files)!=null&&t.length?await this.packTar():null,repository:this.repository,branch:this.branch});console.log("res",e)}catch(e){console.log("error",e)}},async deploy(){var t;try{console.log("files",this.files);const e=await this.io.service("static").create({hostname:this.id,buffer:(t=this.files)!=null&&t.length?await this.packTar():null,repository:this.repository,branch:this.branch});console.log("res",e)}catch(e){console.log("error",e)}},async packTar(){let t=new T;for await(let e of this.files)t.append(e.name,new Uint8Array(e.buffer));return t.out},async uploadZip(){return this.files=[],new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!1,e.accept=".zip",e.onchange=async()=>{let r=Array.from(e.files)[0];const{entries:a}=await B(await r.arrayBuffer());for await(const[i,l]of Object.entries(a))a[i].isDirectory||this.files.push({buffer:await l.arrayBuffer(),name:i});await this.resolveDockerCompose(),t()},e.click()})},async uploadTar(){return this.files=[],new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!1,e.accept=".tar",e.onchange=async()=>{let r=Array.from(e.files)[0],a=await U(await r.arrayBuffer());for await(let i of a)this.files.push({buffer:i.buffer,name:i.name});await this.resolveDockerCompose(),t()},e.click()})},async uploadFolder(){return this.files=[],new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!0,e.webkitdirectory=!0,e.dir=!0,e.onchange=async()=>{let r=Array.from(e.files);for await(let a of r)this.files.push({buffer:await a.arrayBuffer(),name:a.webkitRelativePath});await this.resolveDockerCompose(),t()},e.click()})},async uploadFiles(){return this.files=[],new Promise(t=>{let e=document.createElement("input");e.type="file",e.multiple=!0,e.onchange=async()=>{let r=Array.from(e.files);for await(let a of r){let i=await a.arrayBuffer();this.files.push({buffer:i,name:"root/"+a.name})}await this.resolveDockerCompose(),t()},e.click()})}}},S={class:"font-thin text-xl lg:text-3xl xl:pl-6 w-full text-center uppercase"},V={class:"mt-8 mb-20 relative overflow-auto w-full"},A={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},E=s("label",{class:"block my-2"}," Basic app settings ",-1),H={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},W=s("label",{class:"block my-2"}," Upload using drop of Tar / Zip / Folder / Docker Compose File / Docker File ",-1),N={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},z={class:"block my-2"},R={class:"p-4 overflow-auto shadow-sm my-8 bg-slate-100 text-slate-700"},Z=s("label",{class:"block my-2"}," Clone using Github (With option to autodeploy using push webhooks) ",-1),j={class:"text-right"};function x(t,e,r,a,i,l){const w=h("SectionHero"),k=h("WrapperPage"),g=h("TemplateDefault");return n(),F(g,{renderer:r.renderer},{default:m(()=>[b(w,null,{default:m(()=>[s("h1",S,y(l.id?l.id:"Deploy Static App"),1)]),_:1}),b(k,{class:"p-6"},{default:m(()=>[s("div",V,[s("div",A,[E,c(),t.$route.params.id?p("",!0):d((n(),u("input",{key:0,"onUpdate:modelValue":e[0]||(e[0]=o=>t.hostname=o),placeholder:"Hostname",class:"px-4 py-2 block w-full mb-4"},null,512)),[[f,t.hostname]]),c(),t.$route.params.id?d((n(),u("input",{key:1,"onUpdate:modelValue":e[1]||(e[1]=o=>l.id=o),placeholder:"Hostname",readonly:"",class:"px-4 py-2 block w-full mb-4"},null,512)),[[f,l.id]]):p("",!0)]),s("div",H,[W,s("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[2]||(e[2]=o=>l.uploadFiles())}," Upload files "),s("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[3]||(e[3]=o=>t.uploadFolde())}," Upload folder "),s("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[4]||(e[4]=o=>l.uploadTar())}," Upload tar "),s("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[5]||(e[5]=o=>l.uploadZip())}," Upload zip "),s("button",{class:"rounded p-2 bg-slate-200 block w-full mt-2",onClick:e[6]||(e[6]=o=>t.files=[])}," Clear files ")]),s("div",N,[s("label",z," Files count: "+y(t.files.length),1)]),s("div",R,[Z,s("button",{class:"rounded p-2 bg-slate-200",onClick:e[7]||(e[7]=o=>t.connect())}," Connect to Github "),s("button",{class:"rounded p-2 bg-slate-200 ml-4",onClick:e[8]||(e[8]=o=>t.connect())}," Select repository "),c(),d(s("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>t.repository=o),placeholder:"Repository url",class:"mt-2 px-4 py-2 w-full"},null,512),[[f,t.repository]]),c(),d(s("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>t.branch=o),placeholder:"Branch name",class:"mt-2 px-4 py-2 w-full"},null,512),[[f,t.branch]])]),s("div",j,[!t.$route.params.id&&t.hostname?(n(),u("button",{key:0,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[11]||(e[11]=o=>l.deploy())}," Launch ")):p("",!0),t.$route.params.id?(n(),u("button",{key:1,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[12]||(e[12]=o=>l.update())}," Update ")):p("",!0),t.webhook?p("",!0):(n(),u("button",{key:2,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[13]||(e[13]=o=>l.attach())}," Attach webhook ")),t.webhook?(n(),u("button",{key:3,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[14]||(e[14]=o=>l.detach())}," Detach webhook ")):p("",!0),t.$route.params.id?(n(),u("button",{key:4,class:"py-4 p-2 mt-4 w-full rounded bg-slate-200",onClick:e[15]||(e[15]=o=>l.remove())}," Remove ")):p("",!0)])])]),_:1})]),_:1},8,["renderer"])}const q=$(P,[["render",x]]);export{q as default};
